(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();class x{constructor(){this.folders=[],this.notes=[],this.settings={},this.currentFolderId=null,this.isDragging=!1,this.currentDragNote=null,this.dragOffset={x:0,y:0},this.holidays=[],this.holidaysFetched=!1,this.init()}async init(){await this.loadData(),this.setupEventListeners(),this.updateClock(),this.renderFolders(),this.renderNotes(),this.loadWallpaper(),this.loadQuote(),setInterval(()=>this.updateClock(),1e3),setInterval(()=>this.loadWallpaper(),36e5),this.updateCalendar(),setInterval(()=>this.updateCalendar(),6e4)}async loadData(){try{const e=await this.getStorageData();this.folders=e.folders||[{id:"f1",name:"Pekerjaan",todos:[],expanded:!1},{id:"f2",name:"Pribadi",todos:[],expanded:!1},{id:"f3",name:"Belajar",todos:[],expanded:!1}],this.notes=e.notes||[],this.settings=e.settings||{userName:"User",theme:"auto",tasksExpanded:!0},this.settings.tasksExpanded===void 0&&(this.settings.tasksExpanded=!0)}catch(e){console.error("Error loading data:",e),this.folders=[{id:"f1",name:"Pekerjaan",todos:[],expanded:!1},{id:"f2",name:"Pribadi",todos:[],expanded:!1},{id:"f3",name:"Belajar",todos:[],expanded:!1}],this.notes=[],this.settings={userName:"User",theme:"auto",tasksExpanded:!0}}this.applyTasksState(),this.updateTaskButtonState()}async saveData(){try{await this.setStorageData({folders:this.folders,notes:this.notes,settings:this.settings})}catch(e){console.error("Error saving data:",e)}}getStorageData(){return new Promise(e=>{if(typeof chrome<"u"&&chrome.storage&&chrome.storage.local)chrome.storage.local.get(["folders","notes","settings"],t=>{e(t)});else{const t=localStorage.getItem("zendash_folders"),n=localStorage.getItem("zendash_notes"),s=localStorage.getItem("zendash_settings");e({folders:t?JSON.parse(t):null,notes:n?JSON.parse(n):null,settings:s?JSON.parse(s):null})}})}setStorageData(e){return new Promise(t=>{typeof chrome<"u"&&chrome.storage&&chrome.storage.local?chrome.storage.local.set(e,()=>{t()}):(e.folders&&localStorage.setItem("zendash_folders",JSON.stringify(e.folders)),e.notes&&localStorage.setItem("zendash_notes",JSON.stringify(e.notes)),e.settings&&localStorage.setItem("zendash_settings",JSON.stringify(e.settings)),t())})}updateClock(){const e=new Date,t=e.getHours().toString().padStart(2,"0"),n=e.getMinutes().toString().padStart(2,"0"),s=e.getSeconds().toString().padStart(2,"0"),o=document.getElementById("clock");o&&(o.textContent=`${t}:${n}:${s}`)}updateGreeting(){const e=new Date().getHours(),t=this.settings.userName||"User";let n="Selamat ";e<10?n+="Pagi":e<15?n+="Siang":e<18?n+="Sore":n+="Malam",n+=`, ${t}`;const s=document.getElementById("greeting");s&&(s.textContent=n)}async loadWallpaper(){try{const s=await fetch("https://api.unsplash.com/search/photos?query=Islamic&orientation=landscape&client_id=yhJggUvQ2S76I7Vp2V4dA9NfDZC1t8zJMBaac-DzrE0&per_page=20");if(!s.ok)throw new Error("Unsplash API failed");const o=await s.json();if(!o.results||o.results.length===0)throw new Error("No results from Unsplash");const a=Math.floor(Math.random()*o.results.length),i=o.results[a].urls.regular,u=new Image;u.onload=()=>{const p=document.getElementById("wallpaper");p.style.backgroundImage=`url(${i})`;const r=document.getElementById("photo-author-link"),g=document.getElementById("photo-download-link"),f=o.results[a].user,m=o.results[a].links;r&&f&&(r.textContent=`Photo by ${f.name} on Unsplash`,r.href=`${f.links.html}?utm_source=zendash&utm_medium=referral`),g&&m&&(g.href=`${m.html}?utm_source=zendash&utm_medium=referral`),console.log("Wallpaper loaded from Unsplash:",i)},u.onerror=()=>{throw new Error("Image preloading failed")},u.src=i}catch(e){console.log("Wallpaper fetch failed, using gradient fallback:",e),this.setGradientFallback()}}setGradientFallback(){const e=["linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e8ba3 100%)","linear-gradient(135deg, #134e5e 0%, #71b280 100%)","linear-gradient(135deg, #232526 0%, #414345 100%)","linear-gradient(135deg, #8b0000 0%, #dc143c 50%, #ff6b6b 100%)","linear-gradient(135deg, #2c3e50 0%, #3498db 100%)","linear-gradient(135deg, #1a237e 0%, #3949ab 50%, #5e35b1 100%)","linear-gradient(135deg, #263238 0%, #37474f 50%, #455a64 100%)","linear-gradient(135deg, #3e2723 0%, #5d4037 50%, #8d6e63 100%)"],t=e[Math.floor(Math.random()*e.length)],n=document.getElementById("wallpaper");n&&(n.style.background=t)}async loadQuote(){try{const e=await fetch("/api/quotes/random");if(e.ok){const t=await e.json();this.updateQuote(t.data.text,t.data.author);return}throw new Error("Quote API failed")}catch(e){console.log("Quote API failed, using local fallback:",e);const t=[{text:"Kesuksesan adalah kemampuan untuk bangkit kembali dari kegagalan.",author:"Winston Churchill"},{text:"Jangan menunggu kesempurnaan. Mulai dengan apa yang Anda miliki.",author:"Anonymous"},{text:"Kegagalan adalah bumbu yang membuat kesuksesan terasa lebih manis.",author:"Anonymous"},{text:"Hari ini adalah hadiah, itulah mengapa disebut sebagai masa kini.",author:"Eleanor Roosevelt"},{text:"Satu langkah kecil setiap hari akan membawa Anda ke tempat yang Anda inginkan.",author:"Anonymous"}],n=t[Math.floor(Math.random()*t.length)];this.updateQuote(n.text,n.author)}}updateQuote(e,t){const n=document.getElementById("quote-text"),s=document.getElementById("quote-author");n&&(n.textContent=`"${e}"`,n.classList.add("animate-slide-up")),s&&(s.textContent=`â€” ${t}`)}renderFolders(){const e=document.getElementById("folders-container");e&&(e.innerHTML="",this.folders.forEach(t=>{const n=this.createFolderElement(t);e.appendChild(n)}),this.updateTaskButtonState())}createFolderElement(e){const t=document.createElement("div");t.className="folder-item mb-2",t.setAttribute("draggable","true"),t.dataset.folderId=e.id,t.addEventListener("dragstart",o=>{o.stopPropagation(),this.draggedFolderId=e.id,o.dataTransfer.effectAllowed="move",t.classList.add("opacity-50")}),t.addEventListener("dragend",()=>{t.classList.remove("opacity-50"),this.draggedFolderId=null,document.querySelectorAll(".folder-item").forEach(o=>o.classList.remove("border-t-2","border-blue-400"))}),t.addEventListener("dragover",o=>{o.preventDefault(),o.stopPropagation(),this.draggedFolderId!==e.id&&t.classList.add("border-t-2","border-blue-400")}),t.addEventListener("dragleave",()=>{t.classList.remove("border-t-2","border-blue-400")}),t.addEventListener("drop",o=>{o.preventDefault(),o.stopPropagation(),t.classList.remove("border-t-2","border-blue-400"),this.draggedFolderId&&this.draggedFolderId!==e.id&&this.reorderFolders(this.draggedFolderId,e.id)});const n=document.createElement("div");n.className="glass rounded-lg p-3 cursor-pointer flex items-center justify-between",n.innerHTML=`
            <div class="flex items-center">
                <svg class="w-4 h-4 mr-2 transition-transform ${e.expanded?"rotate-90":""}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
                <span class="font-medium">${e.name}</span>
                <span class="ml-2 text-sm opacity-70">(${e.todos.filter(o=>!o.completed).length}/${e.todos.length})</span>
            </div>
            <div class="flex space-x-2">
                <button class="add-todo-btn p-1 hover:bg-white hover:bg-opacity-20 rounded" data-folder-id="${e.id}">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                </button>
                <button class="delete-folder-btn p-1 hover:bg-white hover:bg-opacity-20 rounded" data-folder-id="${e.id}">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                </button>
            </div>
        `;const s=document.createElement("div");return s.className=`mt-2 space-y-1 ${e.expanded?"block":"hidden"}`,e.todos.forEach(o=>{const a=this.createTodoElement(e.id,o);s.appendChild(a)}),n.addEventListener("click",o=>{o.target.closest("button")||(e.expanded=!e.expanded,this.saveData(),this.renderFolders())}),t.appendChild(n),t.appendChild(s),t}createTodoElement(e,t){const n=document.createElement("div");return n.className="todo-item flex items-center p-2 glass rounded",n.innerHTML=`
            <input type="checkbox" class="mr-3" ${t.completed?"checked":""} data-folder-id="${e}" data-todo-id="${t.id}">
            <span class="${t.completed?"line-through opacity-60":""}">${t.text}</span>
            <button class="ml-auto delete-todo-btn p-1 hover:bg-white hover:bg-opacity-20 rounded" data-folder-id="${e}" data-todo-id="${t.id}">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        `,n}renderNotes(){const e=document.getElementById("notes-grid");e&&(e.innerHTML="",this.notes.forEach(t=>{const n=this.createNoteElement(t);e.appendChild(n)}))}createNoteElement(e){const t=document.createElement("div");t.className="sticky-note relative bg-yellow-200 p-3 rounded-lg shadow-lg cursor-move w-48 min-h-[120px] transition-transform hover:scale-105",t.dataset.noteId=e.id;const n=document.createElement("div");n.className="flex justify-between items-start mb-2";const s=document.createElement("div");s.className="font-semibold text-gray-800 text-sm flex-1",s.textContent=e.title||"Note";const o=document.createElement("button");o.className="text-red-500 hover:text-red-700 text-xs ml-1",o.innerHTML="Ã—",o.addEventListener("click",i=>{i.stopPropagation(),this.deleteNote(e.id)}),n.appendChild(s),n.appendChild(o);const a=document.createElement("div");return a.className="text-gray-700 text-sm whitespace-pre-wrap break-words",a.textContent=e.content,t.appendChild(n),t.appendChild(a),t.addEventListener("mousedown",i=>this.startDrag(i,e.id)),t}startDrag(e,t){if(e.target.tagName==="BUTTON"||(this.isDragging=!0,this.currentDragNote=t,!this.notes.find(i=>i.id===t)))return;const s=e.currentTarget,o=s.getBoundingClientRect();this.dragOffset.x=e.clientX-o.left,this.dragOffset.y=e.clientY-o.top;const a=s.cloneNode(!0);a.id="dragging-clone",a.className=a.className.replace("relative","fixed")+" opacity-75 z-50 pointer-events-none",a.style.left=e.clientX-this.dragOffset.x+"px",a.style.top=e.clientY-this.dragOffset.y+"px",a.style.width=o.width+"px",document.body.appendChild(a),s.style.opacity="0.3",document.addEventListener("mousemove",this.handleDrag),document.addEventListener("mouseup",this.stopDrag),e.preventDefault()}handleDrag=e=>{if(!this.isDragging)return;const t=document.getElementById("dragging-clone");t&&(t.style.left=e.clientX-this.dragOffset.x+"px",t.style.top=e.clientY-this.dragOffset.y+"px")};stopDrag=()=>{if(!this.isDragging)return;this.isDragging=!1;const e=document.getElementById("dragging-clone");e&&e.remove(),document.querySelectorAll(".sticky-note").forEach(t=>{t.style.opacity=""}),document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.stopDrag)};setupEventListeners(){const e=document.getElementById("refresh-quote");e&&e.addEventListener("click",()=>this.loadQuote());const t=document.getElementById("add-folder");t&&t.addEventListener("click",()=>this.showFolderModal());const n=document.getElementById("save-folder"),s=document.getElementById("cancel-folder");document.getElementById("folder-modal"),n&&n.addEventListener("click",()=>this.saveFolder()),s&&s.addEventListener("click",()=>this.hideFolderModal());const o=document.getElementById("save-todo"),a=document.getElementById("cancel-todo");o&&o.addEventListener("click",()=>this.saveTodo()),a&&a.addEventListener("click",()=>this.hideTodoModal());const i=document.getElementById("notes-toggle"),u=document.getElementById("notes-panel"),p=document.getElementById("notes-toggle-text"),r=document.getElementById("add-note");i&&u&&p&&i.addEventListener("click",()=>{u.classList.contains("hidden")?(u.classList.remove("hidden"),p.textContent="ðŸ“ Hide Notes"):(u.classList.add("hidden"),p.textContent="ðŸ“ Show Notes")}),r&&r.addEventListener("click",()=>this.showNoteModal());const g=document.getElementById("tasks-toggle");g&&g.addEventListener("click",()=>this.toggleTasks());const f=document.getElementById("save-note"),m=document.getElementById("cancel-note");f&&f.addEventListener("click",()=>this.saveNote()),m&&m.addEventListener("click",()=>this.hideNoteModal());const l=document.getElementById("about-btn"),y=document.getElementById("close-about"),h=document.getElementById("about-modal");l&&h&&l.addEventListener("click",()=>{h.classList.remove("hidden");const d=h.querySelector("div");d&&(d.classList.remove("scale-95","opacity-0"),d.classList.add("scale-100","opacity-100"))}),y&&h&&y.addEventListener("click",()=>{h.classList.add("hidden")}),h&&h.addEventListener("click",d=>{d.target===h&&h.classList.add("hidden")}),document.addEventListener("click",d=>{const c=d.target.closest('.add-todo-btn, .delete-folder-btn, .delete-todo-btn, input[type="checkbox"]');c&&c.matches(".add-todo-btn")?(d.preventDefault(),this.currentFolderId=c.dataset.folderId,console.log("Add todo clicked for folder:",this.currentFolderId),this.showTodoModal()):c&&c.matches(".delete-folder-btn")?(d.preventDefault(),this.deleteFolder(c.dataset.folderId)):c&&c.matches(".delete-todo-btn")?(d.preventDefault(),this.deleteTodo(c.dataset.folderId,c.dataset.todoId)):c&&c.matches('input[type="checkbox"]')&&(d.preventDefault(),this.toggleTodo(c.dataset.folderId,c.dataset.todoId))});const E=document.getElementById("folder-name"),v=document.getElementById("todo-text");document.getElementById("note-title");const k=document.getElementById("note-content");E&&E.addEventListener("keypress",d=>{d.key==="Enter"&&this.saveFolder()}),v&&v.addEventListener("keypress",d=>{d.key==="Enter"&&this.saveTodo()}),k&&k.addEventListener("keypress",d=>{d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),this.saveNote())})}showFolderModal(){const e=document.getElementById("folder-modal"),t=document.getElementById("folder-name");e&&t&&(e.classList.remove("hidden"),t.value="",t.focus())}hideFolderModal(){const e=document.getElementById("folder-modal");e&&e.classList.add("hidden")}showTodoModal(){const e=document.getElementById("todo-modal"),t=document.getElementById("todo-text");e&&t&&(e.classList.remove("hidden"),t.value="",t.focus())}hideTodoModal(){const e=document.getElementById("todo-modal");e&&e.classList.add("hidden"),this.currentFolderId=null}async saveFolder(){const e=document.getElementById("folder-name");if(!e||!e.value.trim())return;const t={id:"f"+Date.now(),name:e.value.trim(),todos:[],expanded:!1};this.folders.push(t),await this.saveData(),this.renderFolders(),this.hideFolderModal()}async saveTodo(){const e=document.getElementById("todo-text");if(!e||!e.value.trim()||!this.currentFolderId){console.warn("Cannot save todo: missing input, folder ID, or empty text");return}const t=this.folders.find(s=>s.id===this.currentFolderId);if(!t){console.warn("Cannot save todo: folder not found with ID",this.currentFolderId);return}const n={id:"t"+Date.now(),text:e.value.trim(),completed:!1};t.todos.push(n),await this.saveData(),this.renderFolders(),this.hideTodoModal(),t.expanded=!0,await this.saveData(),this.renderFolders()}async deleteFolder(e){confirm("Apakah Anda yakin ingin menghapus folder ini?")&&(this.folders=this.folders.filter(t=>t.id!==e),await this.saveData(),this.renderFolders())}async deleteTodo(e,t){const n=this.folders.find(s=>s.id===e);n&&(n.todos=n.todos.filter(s=>s.id!==t),await this.saveData(),this.renderFolders())}async toggleTodo(e,t){const n=this.folders.find(o=>o.id===e);if(!n)return;const s=n.todos.find(o=>o.id===t);s&&(s.completed=!s.completed,await this.saveData(),this.renderFolders())}showNoteModal(){const e=document.getElementById("note-modal"),t=document.getElementById("note-title"),n=document.getElementById("note-content");e&&t&&n&&(e.classList.remove("hidden"),t.value="",n.value="",n.focus())}hideNoteModal(){const e=document.getElementById("note-modal");e&&e.classList.add("hidden")}async saveNote(){const e=document.getElementById("note-title"),t=document.getElementById("note-content");if(!t||!t.value.trim()){console.warn("Cannot save note: missing content or empty");return}const n={id:"n"+Date.now(),title:e?e.value.trim():"",content:t.value.trim(),createdAt:new Date().toISOString()};this.notes.push(n),await this.saveData(),this.renderNotes(),this.hideNoteModal();const s=document.getElementById("notes-panel"),o=document.getElementById("notes-toggle-text");s&&s.classList.contains("hidden")&&(s.classList.remove("hidden"),o&&(o.textContent="ðŸ“ Hide Notes"))}async deleteNote(e){confirm("Apakah Anda yakin ingin menghapus catatan ini?")&&(this.notes=this.notes.filter(t=>t.id!==e),await this.saveData(),this.renderNotes())}toggleTasks(){this.settings.tasksExpanded=!this.settings.tasksExpanded,this.applyTasksState(),this.saveData()}updateCalendar(){const e=new Date,t=e.getFullYear(),n=e.getMonth(),s=["JANUARI","FEBRUARI","MARET","APRIL","MEI","JUNI","JULI","AGUSTUS","SEPTEMBER","OKTOBER","NOVEMBER","DESEMBER"],o=document.getElementById("calendar-header");o&&(o.textContent=`${s[n]} ${t}`),(!this.holidaysFetched||this.currentMonth!==n)&&(this.loadHolidays(n+1,t),this.currentMonth=n);const a=document.getElementById("calendar-grid");if(!a)return;a.innerHTML="";const i=new Date(t,n,1).getDay(),u=new Date(t,n+1,0).getDate(),p=e.getDate();for(let r=0;r<i;r++){const g=document.createElement("div");a.appendChild(g)}for(let r=1;r<=u;r++){const f=new Date(t,n,r).getDay();`${t}${String(n+1).padStart(2,"0")}${String(r).padStart(2,"0")}`;const m=this.holidays?this.holidays.find(E=>{const v=new Date(E.tanggal);return v.getDate()===r&&v.getMonth()===n&&v.getFullYear()===t}):null,l=document.createElement("div");l.textContent=r,l.className="w-7 h-7 text-sm flex items-center justify-center rounded-full transition-colors duration-200";let y=!1,h=!1;f===0&&(y=!0),m&&(m.is_cuti?(h=!0,l.title=`${m.keterangan} (Cocok untuk ajukan cuti)`):(y=!0,l.title=m.keterangan)),r===p?(l.classList.add("bg-white","bg-opacity-40","font-bold","text-white","shadow-sm"),y?l.classList.add("text-red-200"):h&&l.classList.add("text-orange-200")):(l.classList.add("hover:bg-white","hover:bg-opacity-10","cursor-default"),h?l.classList.add("text-orange-400","font-bold"):y&&l.classList.add("text-red-400","font-bold")),a.appendChild(l)}this.renderHolidaysList()}async loadHolidays(e,t){try{const n=await fetch(`https://dayoffapi.vercel.app/api?month=${e}`);if(n.ok){const s=await n.json();this.holidays=s,this.holidaysFetched=!0,this.updateCalendar()}}catch(n){console.error("Failed to load holidays:",n),this.holidays=[]}}renderHolidaysList(){const e=document.getElementById("calendar-holidays");if(e){if(!this.holidays||this.holidays.length===0){e.classList.add("hidden");return}e.classList.remove("hidden"),e.innerHTML="",this.holidays.forEach(t=>{const n=document.createElement("div");n.className="flex gap-2 text-xs leading-tight opacity-90";const s=document.createElement("span"),o=new Date(t.tanggal);s.textContent=isNaN(o.getTime())?t.tanggal:`${o.getDate()}`,s.className="font-bold w-4 text-right flex-shrink-0";const a=document.createElement("span");let i=t.keterangan;t.is_cuti?(i+=" (Cocok untuk ajukan cuti)",n.classList.add("text-orange-300")):t.is_cuti?n.classList.add("text-orange-300"):n.classList.add("text-red-300"),a.textContent=i,n.appendChild(s),n.appendChild(a),e.appendChild(n)})}}reorderFolders(e,t){const n=this.folders.findIndex(o=>o.id===e),s=this.folders.findIndex(o=>o.id===t);if(n>-1&&s>-1){const[o]=this.folders.splice(n,1);this.folders.splice(s,0,o),this.saveData(),this.renderFolders()}}applyTasksState(){const e=document.getElementById("tasks-sidebar"),t=document.getElementById("main-content-center");e&&(this.settings.tasksExpanded?(e.classList.remove("sidebar-collapsed"),t&&t.classList.add("pr-96")):(e.classList.add("sidebar-collapsed"),t&&t.classList.remove("pr-96"))),this.updateTaskButtonState()}updateTaskButtonState(){const e=document.getElementById("tasks-toggle-text");if(!e)return;let t=0;this.folders.forEach(n=>{t+=n.todos.filter(s=>!s.completed).length}),this.settings.tasksExpanded?e.textContent=`Hide Tasks (${t})`:e.textContent=`Show Tasks (${t})`}}document.addEventListener("DOMContentLoaded",()=>{new x});
